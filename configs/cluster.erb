port: 4222
monitor_port: 8222
server_name: $NAME
client_advertise: $ADVERTISE

cluster {
  port: 6222

  routes = [
    <%- (1..@cluster_members).each do |node| -%>
    nats-route://nc<%= node %>:6222
    <%- end -%>
  ]
}

gateway {
  name: $GATEWAY
  port: 7222

  gateways: [
    <%- (1..@clusters).each do |cluster| -%>
    {
      name: "c<%= cluster %>"
      urls: [
        <%- (1..@cluster_members).each do |node| -%>
          "nats://nc<%= node %>.c<%= cluster %>.<%= @domain %>:7222"
        <%- end -%>
      ]
    }
    <%- end -%>
  ]
}

<%- if @password -%>
accounts {
  one: {
    users = [
      {user: one, password: <%= @password %>}
    ]
    exports = [
      { stream: exports.stream }
    ]
  }

  two: {
    users = [
      {user: two, password: <%= @password %>}
    ]
    exports = [
      { stream: exports.stream }
    ]
  }

  system: {
    users = [
      {user: system, password: <%= @password %>}
    ]
    imports = [
      { stream: { account: one, subject: exports.stream }, prefix: imports.one }
      { stream: { account: two, subject: exports.stream }, prefix: imports.two }
    ]
  }
}

system_account: system
<%- end -%>
